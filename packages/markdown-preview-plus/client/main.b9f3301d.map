{"version":3,"sources":["util.ts","mathjax-helper.ts","update-preview.ts","../src/util-common.ts","main.ts"],"names":["Object","defineProperty","exports","value","getMedia","document","querySelectorAll"],"mappings":";;;;ACAA,ADAA,SAAA,aAAA,CAA8B,OAA9B,EAAmD;ACCnD,ADAE,QAAI,CAAC,OAAL,EAAc;ACChB,ADAE,YAAQ,OAAR,EAAc,UAAC,KAAD,EAAa;AGF7B,AFGA,ADAI,gBAAQ,KAAR,CAAc,KAAd;ACCJ,ADAG,KAFD;AGDFA,AFIA,ADAC,OGJMC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;AACA,AHFA,QAAA,CGESC,QAAT,CAAkBC,GHFlB,GAAA,EGEA,EAA4B,SHF5B;AGGI,AHGJ,IAAA,OGHWA,AHGX,QAAA,CGHoBC,GHGpB,CAAA,YGHW,CAA0B,gCAA1B,CAAP;AACH,AHGD,SAAA,UAAA,CAA2B,QAA3B,EAA2C;AGF3CJ,AHGE,QGHME,AHGF,CAAC,KAAA,EGHP,GAAmBA,KHGZ,CAAW,EGHlB,MHGO,CAAL,EAA2B,OAAO,KAAP;AGF7B,AHGE,WAAO,KAAA,SAAA,CAAU,QAAV,EAAoB,MAApB,EAAP;AACD;AAHD,QAAA,UAAA,GAAA,UAAA;AAKA,SAAA,cAAA,CACE,IADF,EAEE,WAFF,EAEoD;AAElD,QAAI,UAAU,IAAd;AACA,SAAoB,IAAA,KAAA,CAAA,EAAA,gBAAA,WAApB,EAAoB,KAAA,cAAA,MAApB,EAAoB,IAApB,EAAiC;AAA5B,YAAM,QAAK,cAAA,EAAA,CAAX;AACH,YAAM,mBAAuC,QAC1C,gBAD0C,CACzB,cAAY,MAAM,GADO,EAE1C,IAF0C,CAErC,MAAM,KAF+B,CAA7C;AAGA,YAAI,gBAAJ,EAAsB;AACpB,sBAAU,gBAAV;AACD,SAFD,MAEO;AACL;AACD;AACF;AAED,QAAI,YAAY,IAAhB,EAAsB,OAAO,SAAP,CAd4B,CAcX;AACvC,WAAO,OAAP;AACD;AAlBD,QAAA,cAAA,GAAA,cAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEZA;AACA;AACA;AACA;ADIA,ACHA,IDGA,OAAA,QAAA,MAAA,CAAA;AACA,ACHA,IDGA,OAAA,QAAA,QAAA,CAAA;AACA,ACHA,IDGA,KAAA,QAAA,IAAA,CAAA;AACA,ACHA,IDGA,SAAA,QAAA,QAAA,CAAA;AAEA,ACJA,IDIM,QAAW,OAAO,OAAP,CAAe,OAAf,CACf,SADe,IAEhB,+BAFD;AAIA,ACPA;ADQA,ACPA;ADQA,ACPA;ADQA,ACPA;ADQA,ACPA;ADQA,ACPA;ADQA,ACPA;ADQA,ACPA,SDOA,aAAA,CAAoC,UAApC,EAAoD;AGvBpD,AFiBA,IEjBA,QAAA,IAAA;AFkBA;AElBA,AFmBA,IEnBA,aAAA,QAAA,UAAA,CAAA;AACA,AFmBA,IEnBA,mBAAA,QAAA,kBAAA,CAAA;AACA,AHsBE,ACHF,IEnBA,mBAAA,IHsBE,CAAA,CAAA,CAAA,CGtBF,QHsBE,EAAM,QGtBR,CAAA,IHsBE,CAAA;AGrBF,AFmBA,IEnBA,AFmBA,OEnBA,CFmBA,QAAA,IEnBA,MFmBA,CAAA,CEnBA,QAAA,CAAA,CAAA;AACA,AHoBE,ACDF,IEnBA,AFmBA,gBEnBA,AFmBA,GDCE,IAAA,CGpBF,AFmBA,kBAAA,CAAA,CEnBA,CAAA;AAEA,AHmBE,ACAF,IAAA,KEnBA,WFmBA,CEnBA,GAAA,GHmBE,CAAA,CAAA,CAAA,GCAF,MDAE,EAAM,ICAR,SDAqB,UAAb,CAAN,CAAA;AGlBA,AFmBA,QEnBI,KAAJ,AFmBA,aAAA,CAAoB,GAApB,EAAoC;AElBpC,AHiBA,ACCoB,QElBd,IAAI,CFkBU,GElBN,AFkBM,GAAA,GAAA,CElBV,AHiBV,CGjByB,GHiBzB,OGjB0B,OAAD,EAAQ;AAAK,AFmBpC,eEnBqC,QAAQ,OAAT;AAAiB,AFoBtD,KEpBS,CAAV;AAGA,AFmBa,MEnBX,OAAF,GAAY,EFmBC,GEnBb,MFmBa,CAAA,MAAA,GAAb,UAAoB,MAApB,EAAqC,WAArC,EAAyD;AElBzD,WAAO,CAAP,2BFkB4D,SAAO,YAAA;AEjBpE,AHaA;AGXD,AHQA,OGRO,CHQP,OGRA,GAAkB,GHQlB,GAAA,aAAA;AGPE,AHYF,UGZQ,cADU,mBFgBH,GAAC;AEdd,AHYF,ACGM,mBEfW,KFeL,OAAO,EEjBD,AFiBG,iBAAf;AEdJ,AHYF,ACGM,mBEfW,IAAI,CFeX,CAAC,CEfM,EAHC,CFkBR,IAAS,KAA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","file":"main.b9f3301d.map","sourceRoot":"../src-client","sourcesContent":["export function handlePromise(promise: Promise<any>): void {\n  if (!promise) return\n  promise.catch((error: Error) => {\n    console.error(error)\n  })\n}\nimport { lstatSync, existsSync } from 'fs'\nexport function isFileSync(filePath: string) {\n  if (!existsSync(filePath)) return false\n  return lstatSync(filePath).isFile()\n}\n\nexport function resolveElement(\n  root: Element,\n  pathToToken: Array<{ tag: string; index: number }>,\n): Element | undefined {\n  let element = root\n  for (const token of pathToToken) {\n    const candidateElement: HTMLElement | null = element\n      .querySelectorAll(`:scope > ${token.tag}`)\n      .item(token.index) as HTMLElement\n    if (candidateElement) {\n      element = candidateElement\n    } else {\n      break\n    }\n  }\n\n  if (element === root) return undefined // Do not jump to the top of the preview for bad syncs\n  return element\n}\n","//\n// mathjax-helper\n//\n// This module will handle loading the MathJax environment and provide a wrapper\n// for calls to MathJax to process LaTeX equations.\n//\n\nimport path = require('path')\nimport CSON = require('season')\nimport fs = require('fs')\nimport { isFileSync } from './util'\n\nconst mjSrc = `${global.require.resolve(\n  'mathjax',\n)}?delayStartupUntil=configured`\n\n//\n// Process DOM elements for LaTeX equations with MathJax\n//\n// @param domElements An array of DOM elements to be processed by MathJax. See\n//   [element](https://developer.mozilla.org/en-US/docs/Web/API/element) for\n//   details on DOM elements.\n//\nexport async function mathProcessor(domElement: Node) {\n  await loadMathJax()\n  await queueTypeset(domElement)\n}\n\n//\n// Process maths in HTML fragment with MathJax\n//\n// @param html A HTML fragment string\n// @param callback A callback method that accepts a single parameter, a HTML\n//   fragment string that is the result of html processed by MathJax\n//\nexport async function processHTMLString(element: Element) {\n  const msvgh = document.getElementById('MathJax_SVG_Hidden')\n  const svgGlyphs = msvgh && msvgh.parentElement\n  if (svgGlyphs !== null) {\n    return svgGlyphs.innerHTML + element.innerHTML\n  } else {\n    return element.innerHTML\n  }\n}\n\nexport async function rerenderMath() {\n  if (MathJax) {\n    return new Promise<void>((resolve) => {\n      MathJax.Hub.Queue(['Rerender', MathJax.Hub])\n      MathJax.Hub.Queue([resolve])\n    })\n  } else {\n    return\n  }\n}\n\n//\n// Load MathJax environment\n//\n// @param listener method to call when the MathJax script was been\n//   loaded to the window. The method is passed no arguments.\n//\nlet mjPromise: Promise<void> | undefined\nasync function loadMathJax(): Promise<void> {\n  if (mjPromise) return mjPromise\n  mjPromise = attachMathJax()\n  return mjPromise\n}\n\n// for testing\nexport function unloadMathJax(): void {\n  mjPromise = undefined\n  const script = document.head.querySelector(`script[src='${mjSrc}']`)\n  if (script) script.remove()\n}\n\nexport async function jaxTeXConfig() {\n  let userMacros = await loadUserMacros()\n  if (userMacros) {\n    userMacros = checkMacros(userMacros)\n  } else {\n    userMacros = {}\n  }\n  const mathJaxConfig: MathJaxConfig = await window.atomVars.mathJaxConfig\n\n  return {\n    extensions: mathJaxConfig.texExtensions,\n    Macros: userMacros,\n    equationNumbers: mathJaxConfig.numberEquations\n      ? {\n          autoNumber: 'AMS',\n          useLabelIds: false,\n        }\n      : {},\n  }\n}\n\n// private\n\nasync function getUserMacrosPath(): Promise<string> {\n  const home = await window.atomVars.home\n  const userMacrosPath: string | undefined | null = CSON.resolve(\n    path.join(home, 'markdown-preview-plus'),\n  )\n  return userMacrosPath != null\n    ? userMacrosPath\n    : path.join(home, 'markdown-preview-plus.cson')\n}\n\nfunction loadMacrosFile(filePath: string): object {\n  if (!CSON.isObjectPath(filePath)) {\n    return {}\n  }\n  return CSON.readFileSync(filePath, function(error?: Error, object?: object) {\n    if (object === undefined) {\n      object = {}\n    }\n    if (error !== undefined) {\n      console.warn(\n        `Error reading Latex Macros file '${filePath}': ${\n          error.stack !== undefined ? error.stack : error\n        }`,\n      )\n      console.error(`Failed to load Latex Macros from '${filePath}'`, {\n        detail: error.message,\n        dismissable: true,\n      })\n    }\n    return object\n  })\n}\n\nasync function loadUserMacros() {\n  const userMacrosPath = await getUserMacrosPath()\n  if (isFileSync(userMacrosPath)) {\n    return loadMacrosFile(userMacrosPath)\n  } else {\n    console.debug(\n      'Creating markdown-preview-plus.cson, this is a one-time operation.',\n    )\n    createMacrosTemplate(userMacrosPath)\n    return loadMacrosFile(userMacrosPath)\n  }\n}\n\nfunction createMacrosTemplate(filePath: string) {\n  const templatePath = path.join(__dirname, '../assets/macros-template.cson')\n  const templateFile = fs.readFileSync(templatePath, 'utf8')\n  fs.writeFileSync(filePath, templateFile)\n}\n\nfunction checkMacros(macrosObject: object) {\n  const namePattern = /^[^a-zA-Z\\d\\s]$|^[a-zA-Z]*$/ // letters, but no numerals.\n  for (const name in macrosObject) {\n    const value = macrosObject[name]\n    if (!name.match(namePattern) || !valueMatchesPattern(value)) {\n      delete macrosObject[name]\n      console.error(\n        `Failed to load LaTeX macro named '${name}'. Please see the [LaTeX guide](https://github.com/atom-community/markdown-preview-plus/blob/master/docs/math.md#macro-names)`,\n      )\n    }\n  }\n  return macrosObject\n}\n\nfunction valueMatchesPattern(value: any) {\n  // Different check based on whether value is string or array\n  if (Array.isArray(value)) {\n    const macroDefinition = value[0]\n    const numberOfArgs = value[1]\n    if (typeof numberOfArgs === 'number') {\n      return numberOfArgs % 1 === 0 && typeof macroDefinition === 'string'\n    } else {\n      return false\n    }\n  } else if (typeof value === 'string') {\n    return true\n  } else {\n    return false\n  }\n}\n\n// Configure MathJax environment. Similar to the TeX-AMS_HTML configuration with\n// a few unnecessary features stripped away\n//\nasync function configureMathJax() {\n  const mathJaxConfig = await window.atomVars.mathJaxConfig\n  MathJax.Hub.Config({\n    jax: ['input/TeX', `output/${mathJaxConfig.renderer}`],\n    extensions: [],\n    TeX: await jaxTeXConfig(),\n    'HTML-CSS': {\n      availableFonts: [],\n      webFont: 'TeX',\n      imageFont: null as any, // TODO: complain on DT\n      undefinedFamily: mathJaxConfig.undefinedFamily as any, // TODO: complain on DT\n      mtextFontInherit: true,\n    },\n    messageStyle: 'none',\n    showMathMenu: false,\n    skipStartupTypeset: true,\n  })\n  MathJax.Hub.Configured()\n\n  // Notify user MathJax has loaded\n  console.log('Loaded maths rendering engine MathJax')\n}\n\n//\n// Attach main MathJax script to the document\n//\nasync function attachMathJax(): Promise<void> {\n  console.log('Loading maths rendering engine MathJax')\n\n  // Attach MathJax script\n  await Promise.all([injectScript(mjSrc)])\n  await configureMathJax()\n}\n\nasync function injectScript(scriptSrc: string) {\n  const script = document.createElement('script')\n  script.src = scriptSrc\n  script.type = 'text/javascript'\n  document.head.appendChild(script)\n  return new Promise<void>((resolve) => {\n    script.addEventListener('load', () => resolve())\n  })\n}\n\nasync function queueTypeset(domElement: Node) {\n  const hasUnprocessedMath = Array.from(\n    document.querySelectorAll('script[type^=\"math/tex\"]'),\n  ).some((x) => !x.id)\n  if (!hasUnprocessedMath) return\n  const mathJaxConfig: MathJaxConfig = await window.atomVars.mathJaxConfig\n  return new Promise<void>((resolve) => {\n    if (MathJax.InputJax.TeX) {\n      MathJax.Hub.Queue(['resetEquationNumbers', MathJax.InputJax.TeX])\n      if (mathJaxConfig.numberEquations) {\n        MathJax.Hub.Queue(['PreProcess', MathJax.Hub])\n        MathJax.Hub.Queue(['Reprocess', MathJax.Hub])\n      }\n    }\n\n    MathJax.Hub.Queue(['Typeset', MathJax.Hub, domElement])\n    MathJax.Hub.Queue([resolve])\n  })\n}\n","// This file incorporates code from [markmon](https://github.com/yyjhao/markmon)\n// covered by the following terms:\n//\n// Copyright (c) 2014, Yao Yujian, http://yjyao.com\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport morph = require('morphdom')\nimport MathJaxHelper = require('./mathjax-helper')\n\nexport class UpdatePreview {\n  constructor(private dom: HTMLElement) {\n    /* no-op */\n  }\n\n  public async update(newDom: Element, renderLaTeX: boolean): Promise<void> {\n    for (const m of Array.from(newDom.querySelectorAll('span.math'))) {\n      const mscr = m.firstElementChild as HTMLScriptElement | null\n      if (!mscr || mscr.nodeName !== 'SCRIPT') continue\n      m.isSameNode = function(target: Node) {\n        if (target.nodeName !== 'SPAN') return false\n        const el = target as HTMLSpanElement\n        if (!el.classList.contains('math')) return false\n        const scr = el.querySelector('script')\n        if (!scr) return false\n        return mscr.innerHTML === scr.innerHTML && mscr.type === scr.type\n      }\n    }\n\n    morph(this.dom, newDom, {\n      childrenOnly: true,\n    })\n\n    // A very specific fix for #386 and #406\n    for (const li of this.dom.querySelectorAll('li')) {\n      if (\n        li.firstElementChild &&\n        li.firstElementChild === li.lastElementChild &&\n        li.firstElementChild.tagName === 'P' &&\n        li.firstChild &&\n        li.firstChild.nodeType === Node.TEXT_NODE &&\n        li.firstChild.textContent === '\\n'\n      ) {\n        li.removeChild(li.firstChild)\n      }\n    }\n\n    if (renderLaTeX) {\n      return MathJaxHelper.mathProcessor(this.dom)\n    }\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction getMedia(document) {\n    return document.querySelectorAll('img[src],audio[src],video[src]');\n}\nexports.getMedia = getMedia;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC1jb21tb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXRpbC1jb21tb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxrQkFBeUIsUUFBc0I7SUFDN0MsT0FBTyxRQUFRLENBQUMsZ0JBQWdCLENBQzlCLGdDQUFnQyxDQUNxQyxDQUFBO0FBQ3pFLENBQUM7QUFKRCw0QkFJQyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBnZXRNZWRpYShkb2N1bWVudDogSFRNTERvY3VtZW50KSB7XG4gIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICdpbWdbc3JjXSxhdWRpb1tzcmNdLHZpZGVvW3NyY10nLFxuICApIGFzIE5vZGVMaXN0T2Y8SFRNTEltYWdlRWxlbWVudCB8IEhUTUxBdWRpb0VsZW1lbnQgfCBIVE1MVmlkZW9FbGVtZW50PlxufVxuIl19","import { ipcRenderer } from 'electron'\nimport { UpdatePreview } from './update-preview'\nimport { processHTMLString, jaxTeXConfig, rerenderMath } from './mathjax-helper'\nimport * as util from './util'\nimport { getMedia } from '../src/util-common'\n\nfunction mkResPromise<T>(): ResolvablePromise<T> {\n  let resFn: (value?: T | PromiseLike<T> | undefined) => void\n  const p = new Promise<T>((resolve) => (resFn = resolve)) as ResolvablePromise<\n    T\n  >\n  p.resolve = resFn!\n  return p\n}\n\nwindow.atomVars = {\n  home: mkResPromise(),\n  mathJaxConfig: mkResPromise(),\n  sourceLineMap: new Map(),\n  revSourceMap: new WeakMap(),\n}\n\nipcRenderer.on<'init'>(\n  'init',\n  (_evt, { atomHome, mathJaxConfig, mathJaxRenderer }) => {\n    window.atomVars.home.resolve(atomHome)\n    window.atomVars.mathJaxConfig.resolve({\n      ...mathJaxConfig,\n      renderer: mathJaxRenderer,\n    })\n  },\n)\n\nipcRenderer.on<'set-source-map'>('set-source-map', (_evt, { map }) => {\n  const root = document.querySelector('div.update-preview')\n  if (!root) throw new Error('No root element!')\n  const slsm = new Map<number, Element>()\n  const rsm = new WeakMap<Element, number[]>()\n  for (const lineS of Object.keys(map)) {\n    const line = parseInt(lineS, 10)\n    const path = map[line]\n    const elem = util.resolveElement(root, path)\n    if (elem) {\n      slsm.set(line, elem)\n      const rsmel = rsm.get(elem)\n      if (rsmel) rsmel.push(line)\n      else rsm.set(elem, [line])\n    }\n  }\n  window.atomVars.sourceLineMap = slsm\n  window.atomVars.revSourceMap = rsm\n})\n\nipcRenderer.on<'scroll-sync'>(\n  'scroll-sync',\n  (_evt, { firstLine, lastLine }) => {\n    const mean = Math.floor(0.5 * (firstLine + lastLine))\n    const slm = window.atomVars.sourceLineMap\n    let topLine\n    let topBound\n    for (topLine = mean; topLine >= 0; topLine -= 1) {\n      topBound = slm.get(topLine)\n      if (topBound) break\n    }\n    if (!topBound) return\n\n    const max = Math.max(...Array.from(slm.keys()))\n    let bottomLine\n    let bottomBound\n    for (bottomLine = mean + 1; bottomLine < max; bottomLine += 1) {\n      bottomBound = slm.get(bottomLine)\n      if (bottomBound) break\n    }\n    if (!bottomBound) return\n    const topScroll = topBound.getBoundingClientRect().top\n    const bottomScroll = bottomBound.getBoundingClientRect().top\n    const frac = (mean - firstLine) / (lastLine - firstLine)\n    const offset = document.documentElement.scrollTop\n    const clientHeight = document.documentElement.clientHeight\n    const top =\n      offset - clientHeight / 2 + topScroll + frac * (bottomScroll - topScroll)\n    window.scroll({ top })\n  },\n)\n\nipcRenderer.on<'style'>('style', (_event, { styles }) => {\n  let styleElem = document.head.querySelector('style#atom-styles')\n  if (!styleElem) {\n    styleElem = document.createElement('style')\n    styleElem.id = 'atom-styles'\n    document.head.appendChild(styleElem)\n  }\n  styleElem.innerHTML = styles.join('\\n')\n})\n\nipcRenderer.on<'update-images'>('update-images', (_event, { oldsrc, v }) => {\n  const imgs = getMedia(document)\n  for (const img of Array.from(imgs)) {\n    let ovs: string | undefined\n    let ov: number | undefined\n    let src = img.getAttribute('src')!\n    const match = src.match(/^(.*)\\?v=(\\d+)$/)\n    if (match) [, src, ovs] = match\n    if (src === oldsrc) {\n      if (ovs !== undefined) ov = parseInt(ovs, 10)\n      if (v !== ov) img.src = v ? `${src}?v=${v}` : `${src}`\n    }\n  }\n})\n\nipcRenderer.on<'sync'>('sync', (_event, { line }) => {\n  const root = document.querySelector('div.update-preview')\n  if (!root) return\n\n  let element = window.atomVars.sourceLineMap.get(line)\n\n  if (!element) {\n    for (let i = line - 1; i >= 0; i -= 1) {\n      element = window.atomVars.sourceLineMap.get(line)\n      if (element) break\n    }\n  }\n\n  if (!element) return\n\n  element.scrollIntoViewIfNeeded(true)\n\n  element.classList.add('flash')\n  setTimeout(() => element!.classList.remove('flash'), 1000)\n})\n\nipcRenderer.on<'use-github-style'>('use-github-style', (_event, { value }) => {\n  const elem = document.querySelector('markdown-preview-plus-view')\n  if (!elem) throw new Error(`Can't find MPP-view`)\n  if (value) {\n    elem.setAttribute('data-use-github-style', '')\n  } else {\n    elem.removeAttribute('data-use-github-style')\n  }\n})\n\nlet updatePreview: UpdatePreview | undefined\n\nipcRenderer.on<'update-preview'>(\n  'update-preview',\n  (_event, { id, html, renderLaTeX }) => {\n    // div.update-preview created after constructor st UpdatePreview cannot\n    // be instanced in the constructor\n    const preview = document.querySelector('div.update-preview')\n    if (!preview) return\n    if (!updatePreview) {\n      updatePreview = new UpdatePreview(preview as HTMLElement)\n    }\n    const parser = new DOMParser()\n    const domDocument = parser.parseFromString(html, 'text/html')\n    util.handlePromise(\n      updatePreview.update(domDocument.body, renderLaTeX).then(async () => {\n        ipcRenderer.sendToHost<'request-reply'>('request-reply', {\n          id,\n          request: 'update-preview',\n          result: await processHTMLString(preview),\n        })\n      }),\n    )\n    const doc = document\n    if (doc && domDocument.head.hasChildNodes) {\n      let container = doc.head.querySelector('original-elements')\n      if (!container) {\n        container = doc.createElement('original-elements')\n        doc.head.appendChild(container)\n      }\n      container.innerHTML = ''\n      for (const headElement of Array.from(domDocument.head.childNodes)) {\n        container.appendChild(headElement)\n      }\n    }\n  },\n)\n\nconst baseElement = document.createElement('base')\ndocument.head.appendChild(baseElement)\n\nipcRenderer.on<'set-base-path'>('set-base-path', (_evt, { path }) => {\n  if (path) baseElement.href = path\n  else baseElement.href = ''\n})\n\nipcRenderer.on<'error'>('error', (_evt, { msg }) => {\n  const preview = document.querySelector('div.update-preview')\n  if (!preview) return\n  const errorDiv = document.createElement('div')\n  errorDiv.innerHTML = `<h2>Previewing Markdown Failed</h2><h3>${msg}</h3>`\n  preview.appendChild(errorDiv)\n})\n\ndocument.addEventListener('mousewheel', (event) => {\n  if (event.ctrlKey) {\n    if (event.wheelDeltaY > 0) {\n      ipcRenderer.sendToHost<'zoom-in'>('zoom-in', undefined)\n    } else if (event.wheelDeltaY < 0) {\n      ipcRenderer.sendToHost<'zoom-out'>('zoom-out', undefined)\n    }\n    event.preventDefault()\n    event.stopPropagation()\n  }\n})\n\ndocument.addEventListener('scroll', (_event) => {\n  const el = document.documentElement\n  const height = el.clientHeight\n  const visible = Array.from(window.atomVars.sourceLineMap.entries())\n    .filter(([_line, elem]) => {\n      const { top, bottom } = elem.getBoundingClientRect()\n      return top > 0 && bottom < height\n    })\n    .map(([line, _elem]) => line)\n  ipcRenderer.sendToHost<'did-scroll-preview'>('did-scroll-preview', {\n    max: Math.max(...visible),\n    min: Math.min(...visible),\n  })\n})\n\nlet lastContextMenuTarget: HTMLElement\ndocument.addEventListener('contextmenu', (e) => {\n  lastContextMenuTarget = e.target as HTMLElement\n})\n\nipcRenderer.on<'sync-source'>('sync-source', (_, { id }) => {\n  let element = lastContextMenuTarget\n  const rsm = window.atomVars.revSourceMap\n  let lines = rsm.get(element)\n\n  while (!lines && element.parentElement) {\n    element = element.parentElement\n    lines = rsm.get(element)\n  }\n  if (!lines) return\n\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\n    id,\n    request: 'sync-source',\n    result: Math.min(...lines),\n  })\n})\n\nipcRenderer.on<'reload'>('reload', (_, { id }) => {\n  window.onbeforeunload = null\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\n    id,\n    request: 'reload',\n    result: undefined,\n  })\n})\n\nwindow.onbeforeunload = function() {\n  return false\n}\n\nipcRenderer.on<'get-tex-config'>('get-tex-config', async (_, { id }) => {\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\n    id,\n    request: 'get-tex-config',\n    result: await jaxTeXConfig(),\n  })\n})\n\nipcRenderer.on<'set-width'>('set-width', async (_, { id, width }) => {\n  if (width === undefined) {\n    document.documentElement.style.removeProperty('width')\n  } else {\n    document.documentElement.style.setProperty(\n      'width',\n      `${width}mm`,\n      'important',\n    )\n  }\n  await rerenderMath()\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\n    id,\n    request: 'set-width',\n    result: undefined,\n  })\n})\n\nipcRenderer.on<'get-selection'>('get-selection', async (_, { id }) => {\n  const selection = window.getSelection()\n  const selectedText = selection.toString()\n  const selectedNode = selection.baseNode\n\n  ipcRenderer.sendToHost<'request-reply'>('request-reply', {\n    id,\n    request: 'get-selection',\n    result: selectedText && selectedNode ? selectedText : undefined,\n  })\n})\n"]}